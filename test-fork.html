<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Fork Debug</title>
</head>
<body>
    <h1>Test Fork Debug</h1>
    <button id="test-btn">Test Fork Simple</button>
    <pre id="output"></pre>

    <script src="BrainfuckInterpreter.js"></script>
    <script>
        document.getElementById('test-btn').addEventListener('click', () => {
            const output = document.getElementById('output');
            output.textContent = '';
            
            try {
                console.log('=== Début test fork ===');
                
                // Test simple: ++++f.>.
                const interpreter = new BrainfuckInterpreter('++++f.>.');
                output.textContent += 'Interpréteur créé\n';
                
                console.log('État initial:', interpreter.getState());
                output.textContent += 'État initial: ' + JSON.stringify(interpreter.getState(), null, 2) + '\n\n';
                
                // Exécuter une étape pour arriver au fork
                let step = 0;
                while (!interpreter.getState().halted && step < 10) {
                    step++;
                    console.log(`--- Étape ${step} ---`);
                    interpreter.step();
                    const state = interpreter.getState();
                    console.log('Après step:', state);
                    output.textContent += `Étape ${step}: IP=${state.ip}, instruction="${state.code[state.ip-1] || 'N/A'}", threads=${state.totalThreads}\n`;
                    
                    if (state.totalThreads > 1) {
                        output.textContent += 'FORK DÉTECTÉ!\n';
                        const allStates = interpreter.getAllThreadStates();
                        output.textContent += 'Tous les threads: ' + JSON.stringify(allStates, null, 2) + '\n';
                        break;
                    }
                }
                
                console.log('=== Fin test fork ===');
                
            } catch (error) {
                console.error('Erreur:', error);
                output.textContent += 'ERREUR: ' + error.message + '\n';
            }
        });
    </script>
</body>
</html>
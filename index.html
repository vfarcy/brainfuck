<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† Interpr√©teur Brainfuck (BrainJS)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
        }
        h1, h2 {
            color: #333;
        }
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            font-family: monospace;
            font-size: 14px;
        }
        button {
            padding: 10px 15px;
            margin-right: 10px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        #run-all { background-color: #4CAF50; color: white; }
        #run-all:hover:not(:disabled) { background-color: #45a049; }
        #step-btn { background-color: #2196F3; color: white; }
        #step-btn:hover:not(:disabled) { background-color: #0b7dda; }
        #reset-btn { background-color: #f44336; color: white; }
        #reset-btn:hover:not(:disabled) { background-color: #da190b; }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #output-view {
            white-space: pre-wrap;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: #fff;
            min-height: 50px;
        }
        #memory-view {
            margin-top: 15px;
            overflow-x: auto;
        }
        #memory-view table {
            border-collapse: collapse;
            font-size: 14px;
            min-width: 500px;
        }
        #memory-view td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .header-row td {
            font-weight: bold;
            background-color: #f0f0f0;
            color: #555;
        }
        .active-cell {
            background-color: #ff9900 !important;
            color: white;
            font-weight: bold;
            border-color: #cc7a00 !important;
        }
        .ip-highlight {
            background-color: #ff9900; /* Utiliser la m√™me couleur d'accentuation */
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>

    <h1>üß† BrainJS: Interpr√©teur Brainfuck</h1>

    <label for="bf-code">Entrez votre programme Brainfuck :</label>
    <textarea id="bf-code" rows="10" cols="80">++++++++[>++++[>++>+++>+++>+<<<<-]>+>+>->>+[<]<-]>>.>---.+++++++..+++.>>.<-.<.+++.------.--------.>>+.>++.</textarea>
    
    <p>
        <button id="run-all">‚ñ∂ Ex√©cuter D'un Coup</button>
        <button id="step-btn">üë£ Ex√©cuter Pas √† Pas</button>
        <button id="reset-btn">üîÑ R√©initialiser</button>
    </p>

    <hr>

    <h2>Sortie (Output)</h2>
    <pre id="output-view">En attente d'ex√©cution...</pre>

    <hr>

    <h2>√âtat de l'Interpr√©teur</h2>
    <p>
        Pointeur d'Instruction (IP): <span id="ip-view">0</span>
        &nbsp;|&nbsp;
        Pointeur de Cellule (PTR): <span id="ptr-view">0</span>
    </p>

    <h3>Code en cours d'ex√©cution</h3>
    <pre id="code-view" style="border: 1px solid #ddd; padding: 10px; background-color: #fff;"></pre>

    <h3>M√©moire (Cellules autour du PTR)</h3>
    <div id="memory-view"></div>

    <script src="BrainfuckInterpreter.js"></script> 

    <script>
        let interpreter = null;

        // R√©f√©rences DOM
        const codeInput = document.getElementById('bf-code');
        const outputView = document.getElementById('output-view');
        const ipView = document.getElementById('ip-view');
        const ptrView = document.getElementById('ptr-view');
        const memoryView = document.getElementById('memory-view');
        const codeView = document.getElementById('code-view');
        const runAllBtn = document.getElementById('run-all');
        const stepBtn = document.getElementById('step-btn');
        const resetBtn = document.getElementById('reset-btn');

        /**
         * Initialise ou r√©initialise l'interpr√©teur avec le code actuel.
         */
        function initializeInterpreter() {
            try {
                // La classe BrainfuckInterpreter doit √™tre d√©finie globalement par le script charg√©
                interpreter = new BrainfuckInterpreter(codeInput.value);
                updateUI();
                runAllBtn.disabled = false;
                stepBtn.disabled = false;
                outputView.textContent = "Programme r√©initialis√©.";
            } catch (error) {
                alert("Erreur de syntaxe Brainfuck: " + error.message);
                interpreter = null;
            }
        }

        /**
         * Met √† jour tous les √©l√©ments de l'interface utilisateur en fonction
         * de l'√©tat actuel de l'interpr√©teur.
         */
        function updateUI() {
            if (!interpreter) return;

            const state = interpreter.getState();

            // 1. Mise √† jour des compteurs et sortie
            outputView.textContent = state.output;
            ipView.textContent = state.ip;
            ptrView.textContent = state.ptr;

            // 2. Visualisation du code et du Pointeur d'Instruction (IP)
            const code = state.code;
            let codeDisplay = '';
            for (let i = 0; i < code.length; i++) {
                if (i === state.ip) {
                    // Met en √©vidence l'instruction en cours d'ex√©cution
                    codeDisplay += `<span class="ip-highlight">${code[i]}</span>`;
                } else {
                    codeDisplay += code[i];
                }
            }
            codeView.innerHTML = codeDisplay;


            // 3. Visualisation de la m√©moire et du Pointeur de Cellule (PTR)
            let memDisplay = '<table>';
            const windowSize = 5; // Nombre de cellules √† afficher de chaque c√¥t√© du PTR
            const start = Math.max(0, state.ptr - windowSize);
            const end = Math.min(state.ptr + windowSize + 1, state.memoryFull.length);

            // Ligne 1: Index (PTR)
            memDisplay += '<tr class="header-row">';
            for (let i = start; i < end; i++) {
                memDisplay += `<td>${i}</td>`;
            }
            memDisplay += '</tr>';

            // Ligne 2: Valeurs (Contenu de la cellule)
            memDisplay += '<tr>';
            for (let i = start; i < end; i++) {
                const cellClass = i === state.ptr ? 'active-cell' : '';
                memDisplay += `<td class="${cellClass}">${state.memoryFull[i]}</td>`;
            }
            memDisplay += '</tr>';
            memDisplay += '</table>';

            memoryView.innerHTML = memDisplay;

            // 4. Gestion de la fin du programme
            if (state.halted) {
                runAllBtn.disabled = true;
                stepBtn.disabled = true;
                if (!outputView.textContent.includes("termin√©")) {
                    outputView.textContent += "\n\n--- Programme termin√© ---";
                }
            }
        }

        // --- Gestionnaires d'√©v√©nements ---

        runAllBtn.addEventListener('click', () => {
            if (!interpreter || interpreter.getState().halted) initializeInterpreter();
            if (interpreter) {
                interpreter.runAll();
                updateUI();
            }
        });

        stepBtn.addEventListener('click', () => {
            // R√©initialiser si le programme est termin√©
            if (!interpreter || interpreter.getState().halted) initializeInterpreter(); 
            if (interpreter) {
                interpreter.step();
                updateUI();
            }
        });

        resetBtn.addEventListener('click', () => {
            initializeInterpreter();
        });

        // Initialisation au chargement de la page
        // Un l√©ger d√©lai pour s'assurer que BrainfuckInterpreter.js est charg√©
        window.addEventListener('load', () => {
            if (typeof BrainfuckInterpreter === 'undefined') {
                alert("Erreur: Le fichier 'BrainfuckInterpreter.js' n'a pas √©t√© trouv√© ou charg√© correctement.");
            } else {
                initializeInterpreter();
            }
        });

    </script>
</body>
</html>


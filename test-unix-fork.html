<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Unix-Style Fork - Brainfuck Interpreter v1.4.0</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #3498db;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .code-display {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        .output-display {
            background: #34495e;
            color: #1abc9c;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            min-height: 100px;
            white-space: pre-wrap;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover {
            background: #2980b9;
        }
        .explanation {
            background: #e8f6f3;
            border-left: 4px solid #1abc9c;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÄ Test Unix-Style Fork - Brainfuck v1.4.0</h1>
        
        <div class="explanation">
            <h3>üéØ Comportement Unix-Style Fork:</h3>
            <ul>
                <li><strong>Thread Parent:</strong> Re√ßoit le PID de l'enfant (valeur > 0)</li>
                <li><strong>Thread Enfant:</strong> Re√ßoit 0</li>
                <li><strong>Ex√©cution conditionnelle:</strong> Utilise des boucles pour distinguer parent/enfant</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>Test 1: Fork simple avec sortie conditionnelle</h3>
            <div class="explanation">
                <p>Ce programme:</p>
                <ol>
                    <li>Ex√©cute un fork (f)</li>
                    <li>Si valeur = 0 (enfant): affiche 'C' (Child)</li>
                    <li>Si valeur > 0 (parent): affiche 'P' (Parent) puis le PID</li>
                </ol>
            </div>
            <div class="code-display">++++++++[>++++[>++>+++>+++>+<<<<-]>+>+>->>+[<]<-]>>.>---.>+.+++++++..+++.>>.<-.<.+++.------.--------.>>+.</div>
            <div class="code-display">f                    # Fork: Parent re√ßoit PID enfant, Enfant re√ßoit 0
[                     # Si valeur > 0 (parent)
  >++++++++++         # Cellule suivante = 10 pour newline
  [>++++[>++<<-]>>+<-] # Pr√©parer 'P' (80)
  >++.                # Afficher 'P' (Parent)
  <                   # Retour au PID
  .                   # Afficher le PID (comme nombre)
  >++++++++++.        # Afficher newline
  <<                  # Revenir √† la cellule originale
]
+                     # Incr√©menter pour tester si on est l'enfant
[                     # Si valeur > 0 apr√®s increment (on √©tait √† 0, donc enfant)
  -                   # Remettre √† 0
  >++++++++++         # Cellule suivante = 10 pour newline
  [>++++[>++<<-]>>+<-] # Pr√©parer 'C' (67)
  >----.              # Afficher 'C' (Child)
  <++++++++++.        # Afficher newline
  <                   # Revenir
]</div>
            <button onclick="runTest1()">‚ñ∂Ô∏è Ex√©cuter Test 1</button>
            <button onclick="clearOutput('output1')">üßπ Effacer</button>
            <div id="output1" class="output-display">Cliquez sur 'Ex√©cuter Test 1' pour voir le r√©sultat...</div>
        </div>

        <div class="test-section">
            <h3>Test 2: Fork multiple avec identification</h3>
            <div class="explanation">
                <p>Ce programme cr√©e plusieurs forks et affiche l'ID de chaque thread.</p>
            </div>
            <div class="code-display">f                    # Premier fork
f                    # Deuxi√®me fork  
f                    # Troisi√®me fork
+++++++[>++++++++++<-]>++.  # Afficher le contenu de la cellule (PID ou 0)</div>
            <button onclick="runTest2()">‚ñ∂Ô∏è Ex√©cuter Test 2</button>
            <button onclick="clearOutput('output2')">üßπ Effacer</button>
            <div id="output2" class="output-display">Cliquez sur 'Ex√©cuter Test 2' pour voir le r√©sultat...</div>
        </div>

        <div class="test-section">
            <h3>Test 3: Fork avec logique parent/enfant</h3>
            <div class="explanation">
                <p>Utilise la valeur de retour du fork pour ex√©cuter du code diff√©rent selon le processus.</p>
            </div>
            <div class="code-display">f                    # Fork
[>+<-]               # Copier la valeur (PID) dans la cellule suivante
>                    # Aller √† la copie
[                    # Si PID > 0 (parent)
  <                  # Retour √† la cellule originale
  +++++++[>++++++++++<-]>++++. # Afficher 'H' (72) - Hello from parent
  >                  # Cellule suivante
  >+++++++[>++++++++++<-]>.    # Afficher 'i' (105)
  <                  # Retour
  [-]                # Vider la cellule pour sortir
]
<                    # Retour √† la cellule originale
[                    # Si valeur = 0 apr√®s la boucle (enfant)
  +++++++[>++++++++++<-]>++.   # Afficher 'B' (66) - Bye from child
  >+++++++[>++++++++++<-]>++++++. # Afficher 'y' (121)
  >+++++++[>++++++++++<-]>++++. # Afficher 'e' (101)
  <[-]               # Vider pour sortir
]</div>
            <button onclick="runTest3()">‚ñ∂Ô∏è Ex√©cuter Test 3</button>
            <button onclick="clearOutput('output3')">üßπ Effacer</button>
            <div id="output3" class="output-display">Cliquez sur 'Ex√©cuter Test 3' pour voir le r√©sultat...</div>
        </div>
    </div>

    <script src="BrainfuckInterpreter.js"></script>
    <script>
        function clearOutput(elementId) {
            document.getElementById(elementId).textContent = '';
        }

        function runTest1() {
            const code = `f[>++++++++++[>++++[>++<<-]>>+<-]>++.<.>++++++++++.<]++++++++[>++++++++++<-]>++[->++++++++++[>++++[>++<<-]>>+<-]>----.<!++++++++++.<<]`;
            runBrainfuckTest(code, 'output1', 'Test 1 Unix Fork');
        }

        function runTest2() {
            const code = `fff+++++++[>++++++++++<-]>++.`;
            runBrainfuckTest(code, 'output2', 'Test 2 Multiple Forks');
        }

        function runTest3() {
            const code = `f[>+<-]>[<+++++++[>++++++++++<-]>++++.>+++++++[>++++++++++<-]>.<<[-]]<[+++++++[>++++++++++<-]>++.>+++++++[>++++++++++<-]>++++++.>+++++++[>++++++++++<-]>++++.<<[-]]`;
            runBrainfuckTest(code, 'output3', 'Test 3 Parent/Child Logic');
        }

        function runBrainfuckTest(code, outputElementId, testName) {
            const outputElement = document.getElementById(outputElementId);
            outputElement.textContent = `üöÄ Ex√©cution de ${testName}...\n\n`;
            
            try {
                // Callback pour capturer la sortie des threads
                window.onThreadOutput = function(threadId, output) {
                    const currentOutput = outputElement.textContent;
                    const lines = currentOutput.split('\n');
                    
                    // Chercher s'il y a d√©j√† une ligne pour ce thread
                    let threadLineIndex = -1;
                    for (let i = 0; i < lines.length; i++) {
                        if (lines[i].startsWith(`Thread ${threadId}:`)) {
                            threadLineIndex = i;
                            break;
                        }
                    }
                    
                    const newLine = `Thread ${threadId}: "${output}" (${output.length} chars)`;
                    
                    if (threadLineIndex >= 0) {
                        lines[threadLineIndex] = newLine;
                    } else {
                        lines.splice(-1, 0, newLine);  // Ins√©rer avant la derni√®re ligne vide
                    }
                    
                    outputElement.textContent = lines.join('\n');
                };

                const interpreter = new BrainfuckInterpreter(code, '');
                
                // Ex√©cuter en mode multithreading
                const result = interpreter.runAllThreads();
                
                // Afficher les r√©sultats finaux
                setTimeout(() => {
                    const manager = interpreter.threadManager;
                    let finalOutput = outputElement.textContent;
                    finalOutput += '\nüèÅ R√©sultats finaux:\n';
                    
                    for (const [threadId, thread] of manager.threads) {
                        finalOutput += `‚Ä¢ Thread ${threadId}: "${thread.output}" (PID re√ßu: ${thread.memory[0]})\n`;
                    }
                    
                    finalOutput += `\nüìä ${manager.threads.size} thread(s) cr√©√©(s)\n`;
                    finalOutput += `‚úÖ ${testName} termin√©!`;
                    
                    outputElement.textContent = finalOutput;
                }, 100);
                
            } catch (error) {
                outputElement.textContent += `\n‚ùå Erreur: ${error.message}`;
            }
        }
    </script>
</body>
</html>